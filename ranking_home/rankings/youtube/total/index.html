<!doctype html>
<html lang="ja">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title></title>
  <link rel="stylesheet" href="../../../ranking_common/common.css" />
</head>
<body>

  <header id="hdr" class="hdr">
    <div class="inner">
      <a class="brand" href="/">
        <span class="logo" aria-hidden="true"></span>
        <span class="title">なんでもランキング</span>
      </a>

      <button class="nav-toggle"
              aria-controls="drawer"
              aria-expanded="false"
              aria-label="メニューを開く"
              title="メニュー">
        <span class="bar" aria-hidden="true"></span>
        <span class="bar" aria-hidden="true"></span>
        <span class="bar" aria-hidden="true"></span>
      </button>
    </div>
  </header>

  <div class="layout">
    <main class="content">
      <div class="entrycontent">
        <div id="entrycontent_title" data-from="entry" data-bind="title">タイトルを入力</div>
        <div id="entrycontent_date" data-from="meta" data-bind="date">日付を入力</div>
        <div id="entrycontent_explain" data-from="entry" data-bind="explain">説明を入力</div>
        <div class="entrycontent_headmenu">
          関連ページ
        </div>
      </div>

      <nav class="pager" aria-label="Pagination (top)"></nav>
      <table id="data-table">
        <thead></thead>
        <tbody></tbody>
      </table>
      <nav class="pager" aria-label="Pagination (bottom)"></nav>

      <footer class="footer">
        <small>© 2025 なんでもランキング</small>
        <nav class="footer__nav" aria-label="フッター">
          <a href="about/">このサイトについて</a>
          <a href="privacy/">プライバシー</a>
          <a href="terms/">利用規約</a>
          <a href="contact/">お問い合わせ</a>
        </nav>
      </footer>
    </main>

    <aside class="sidenav" aria-label="サイドメニュー">
    <form class="search" role="search" action="search/" method="get">
      <input name="q" type="search" placeholder="キーワードで探す" autocomplete="off" />
      <button class="btn btn--primary" type="submit">検索</button>
    </form>
    <div class="sidenav__section">
      <h2>カテゴリ</h2>
      <a href="rankings/youtube/">YouTube 音楽</a>
    </div>
    <div class="sidenav__section">
      <h2><a href="updates/">更新履歴</a></h2>
    </div>
    </aside>
  </div>

  <div id="backdrop" class="backdrop" hidden></div>
  <nav id="drawer" class="drawer" aria-label="モバイルメニュー" aria-hidden="true">
    <button class="drawer__close" aria-label="メニューを閉じる">×</button>
    <form class="search" role="search" action="search/" method="get">
      <input name="q" type="search" placeholder="キーワードで探す" autocomplete="off" />
      <button class="btn btn--primary" type="submit">検索</button>
    </form>
    <div class="sidenav__section">
      <h2>カテゴリ</h2>
      <a href="rankings/youtube/">YouTube 音楽</a>
    </div>
    <div class="sidenav__section">
      <h2><a href="updates/">更新履歴</a></h2>
    </div>
  </nav>

  <script defer src="../../../ranking_common/common.js"></script>
  <script defer src="article.js"></script>
  <script defer>
    (async () => {
      // 1) どのURLを取りに行ってるか、まずログに出す
      console.log("page:", location.href, "baseURI:", document.baseURI);
    
      const v = new Date().toISOString().slice(0,10); // 1日1回更新なら日付でOK
      const metaUrl  = new URL('meta.json',  document.baseURI);  metaUrl.searchParams.set('v', v);
      const entryUrl = new URL('entry.json', document.baseURI); entryUrl.searchParams.set('v', v);
      console.log("fetch:", metaUrl.href, entryUrl.href);
    
      try {
        const [metaRes, entryRes] = await Promise.all([
          fetch(metaUrl,  { cache:'no-store' }),
          fetch(entryUrl, { cache:'no-store' })
        ]);
        if (!metaRes.ok)  throw new Error(`meta.json ${metaRes.status} ${metaUrl}`);
        if (!entryRes.ok) throw new Error(`entry.json ${entryRes.status} ${entryUrl}`);
    
        const meta  = await metaRes.json();
        const entry = await entryRes.json();
        console.log("meta.json =", meta);
        console.log("entry.json =", entry);
    
        const SRC = { meta, entry };
        const get = (o,p) => p.split('.').reduce((a,k)=>a?.[k], o);
    
        for (const el of document.querySelectorAll('[data-from][data-bind]')) {
          const from = el.dataset.from;              // 'meta' or 'entry'
          const key  = el.dataset.bind;              // 例: 'date' / 'title' / 'explain'
          const src  = SRC[from];
          if (!src) { console.warn("unknown data-from:", from, el); continue; }
    
          let val = get(src, key);
          if (val == null) {
            console.warn("no value:", { from, key, el, keys:Object.keys(src) });
            continue; // フォールバック表示を残す
          }
          const attr = el.dataset.attr;
          if (attr) el.setAttribute(attr, String(val));
          else      el.textContent = String(val);
        }
      } catch (err) {
        console.error("bind failed:", err);
        // 画面にも出すと分かりやすい
        const oops = document.createElement('pre');
        oops.textContent = String(err);
        oops.style.color = 'crimson';
        document.body.appendChild(oops);
      }
    })();
    </script>
</body>
</html>
